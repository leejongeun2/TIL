## 리뷰

---

* 지난주까지 했던 흐름 정리

1. 파이썬 => `언어`
   1. 자료구조 및 알고리즘 => `로직`
   2. 개념 컨셉이 있고 구현체가 있음
      1. 대학교 개념, 각각 서울대, 포항공대등을 의미 
      2. 배열이라고 하는 개념이 있고, 그 구현체는 자바에서 가지고 있는 어레이, 파이썬에서는 리스트가 있음
2. 데이터베이스
   1. `관계형 데이터베이스, 테이블`
3. Html/css, js
   1. `웹 화면`
4. 장고f로 위 4가지가 모였음
5. 요청과 응답이라고 하는 것을 배움
6. 장고에 기본적인 구조 학습 
   1. 앱/mtv패턴 학습
   2. 로직 => 폼을 통해서 데이터를 사용자로 부터 받는 로직
   3. 모델(단일테이블)
      1. 2,3을 통해서 게시판(crud) 구현을 함 -> 모델폼을 활용한 게시판을 작성함 + 인증(회원가입)-> 요청/응답(쿠키/세션, 로그인) ->
      2. 파일을 내가 받는다면? 스태틱파일(서빙) + 게시판  -> 파일



## 수업

---

* 오늘 배울 것 : 1:N 관계

  

* 관게형 데이터베이스

  * 표 떠올리기!! (테이블)
  * 그 표에서 데이터들은 행으로 쌓이고 있고, 컬럼에 어떠한 모습들이 있음(필드)
  * 행에서 고유하게 식별 가능한 기본 키라는 속성이 있으며, 외래 키를 사용하여 각 행에서 서로 다른 테이블 간의 관계를 만드는데 사용할 수 있음
  * 고객정보를 수기로 입력하는 경우, 동명이인을 구분할 수 없음
  * 따라서, 고객정보 아이디를 기록 
  * 외래 키: 관계형 데이터베이스에서 다른 테이블의 행을 식별 할 수 있는 키
    * 고객 테이블에 있는 기본키
  * 관계현 데이터베이스의 관계
    * 1:1 
      * 유저의 비밀번호, 이메일, 이름 기본정보 받고 있음, 필드 조정해서 커스텀, 같이 묶어서 프로필(생년월일등) 
    * 1:n
      * 댓글, 사용자의 글과 댓글
    * m:n
      * 다음주!! 

* 외래키 

  * 유일해야함

* 1:N

  * 아티클-댓글
    1. 모델부터해야함! 모델정의!!
    2. 모델폼 -> 입력창
  * 모델 관계설정
    * **게시글은 댓글을 0개 이상 가진다.** 
      * 게시글은 여러 개의 댓글을 가진다. 
      * 게시글은 댓글을 가지지 않을 수도 있다. 
    * 댓글은 반드시 하나의 게시글에 속한다. 

* 장고 릴레이션 십 필드 종류

  * **외래키(포린키)** -> 이것을 쓸 것임
    * orm에서 혜택을 누림
    * 참조하는 모델의 클래스, 온딜리트 옵션 두개의 필수 위치 인자가 필요
      * 온 딜리트 : 외래키가 참조하는 객체가 사라졌을 때(게시글 삭제 되면), 외래 키를 가진 객체를 어떻게 처리할지를 정의(댓글을 어떻게?)
      * 게시글이 지워졌을떄? 
        * 댓글 같이 삭제 -> `cascade`
        * 댓글로 포인트를 얻을 때, 댓글 삭재ㅔ 금지, 디비 상..다르게 저장하는 것을 디비에 별도 설정

  

  ### 댓글 모델 정의 (댓글 기능 구현)

  * 외래 키 필드는 포린키 클래스를 작성하는 위치와 관계없이 필드의 마지막에 작성 됨

  * 커멘트 모델은 어디에 정의할까? 

    * 어떠한 앱에서 할껀데? 
      * 기존 앱에서 활용, 댓글은 게시글에 종속된 기능이기 때문, 게시판을 담당하는 것이 아티클앱이고 댓글 작성하는 것은 그 게시판에 하는 것이기 때문, 아래 질문들에 의하면 아티클 앱에서 작성해야함
    * 댓글목록 어디에 표현할까? => 게시글 상세(아티클 디테일)
    * 댓글작성 => 게시글 상세(아티클:디테일)
    * 댓글 생성  => 디비에 저장 후
    * 생성 완료 후에는 무엇을 해야할까? -> 상세페이지로 보내줌 
    * 모델 설계(정의) 
      * 생성시간
      * 내용
      * 아티클 아이디
    * 모델폼
    * 모델.py에서 모델 만듬
      * 컨텐트, created_at, 아티클=모델스.포린키(아티클, on_delete-=models.cascade)
      * 메마마
      * 쉘로 디비 조작언어 연습
        * 게시글 13번에 내용이 111인 댓글을 생성하는 코드
        * Comment.objects.create(content='111', article=article), 뒤에 인자 article_id=13도 가능
        * 13번 게시글의 모든 댓글을 알고자 할 때 코드
        * Comment.objects.filter(article_id = 13)
        * Article.comment_set.all() 아티클 객체의 모든 댓글

    * 댓글목록
      * 게시글 상세페이지에 씀
      * 뷰즈 > 디테일에서 코드 작성(댓글 목록을 게시글별로 출력하는코드를 작성하고 오세요)
      * comments = article.comment_set.all()
        * 게시글 상세페이지에서 댓글들을 출력(템플릿)
        * 템플릿에서 쓸 수 있는 변수는 컨텍스트로 넘겨준 친구들
    * 사용자가 댓 글 작성
      * 게시글 상세페이지 
      * 생성 디비 저장
      * 사용자에게 폼 제공해주는 곳이 게시글 상세페이지
        1. 모델 폼 만들고 (여기서 중요한 것이 어떠한 모델에 어떠한 필드를 쓸 것이냐!!!!)
        2. 뷰
      * 디비 저장
        * 유알엘에서 패쓰만듬
        * 뷰 
          * 아티클 글 가져오고 
          * 커멘트 폼 = 커멘트폼(리퀘스트 포스트) => 어떠한 클래스의 인스턴스일까?? => 커멘트폼의 인스턴스(모델폼의 인스턴스) 
          * 이즈 밸리드
          * 커멘트 폼.세이브(commit=false) => 커멘트는 어떠한 클래스의 인스턴스일까?? => 커멘트 클래스의 인스턴스이다. (모델 폼의 세이브 메서드는 리턴 값이 그 모델의 인스턴스다! 이기 떄문)
          * 커멘트.아티클 = 아티클
          * 커멘트 세이브
          * 리턴 리다이렉트(이티클 디테일페이지, 아티클의 피케이)
        * 템플릿
          * 디테일 폼에 포스트, 유알엘 이동할 곳 설정, article.pk

    ![image-20221018110633822](1018_화.assets/image-20221018110633822.png)

    ![image-20221018104321178](1018_화.assets/image-20221018104321178.png)

  

### 오늘의 내용 정리

* 모델에서 커멘트가 아티클 직접 참조, 아티클이 커멘트를 역참조
* 커멘트.아티클은 아티클 객체다. 
* 아티클.커멘트_set(모델이름 _set): 커멘트 쿼리 셋(n개임, 왜냐면 1:n 관게이기 때문)



1. 모델정의 포린키: 대상의 모델(누구 참조?), 삭제시(대상 사라지면?)
2. 모델폼 활용한 정의: 요청 데이터를 리퀘스트.포스트 를 모델 폼에 넣고 , 검증, 저장했었음
   1. 이번 상황에서는 저장을 하는데, 추가 값을 포함해야해서, (커밋=flase)커밋을 하지마!(멈춰!)인스턴스를 직접 조작하고 직접 세이브 메서드를 호출, 세이브 메서드는 모델 인스턴스, 커밋 앞에는 모델폼 인스턴스의 세이브이다. 



### 추천(내일꺼ㅎ)

* 사용자-글
* 사용자-댓글
* 프로필 페이지에서 사용자가 쓴 글들
* 사용자가 쓴 댓글들



```django
# foreignkey
class comment
	article = models.foreigenkey(article,...)
* 참조하는 테이블: comment
* 참조되는 테이블: article

* articles_comment(앱이름_참조하는테이블) table생성 => comment 테이블에 article_id필드(foreignkey) 생성됨



## 첫번째 댓글 생성
1. Comment 모델 클래스의 인스턴스 comment 생성
	comment = Comment()
2. 인스턴스에 변수저장
	comment.content = 'first comment'
3. 글 생성
	article = Article.objects.create(title='title', content='content')
4. 글 생성 확인
	article =>  <Article: title>
5. # 외래 키 데이터 입력, 다음과 같이 article 객체 자체를 넣을 수 있음
    commenet.article = article
6. 댓글 저장
    comment.save()
7. 저장 된 것 확인 comment => <Comment: first comment>
    

```

```django
## 두번쨰 댓글생성
1. 인스턴스 생성 및 변수(content, article) 저장
 comment = Comment(content='second comment', article=article) 
2. 댓글 저장
	comment.save()
3. 저장 된 것 확인 comment =>  <Comment: second comment>
```



```django
article.comment_set.method()
* Article 모델이 Comment 모델을 참조(역참조)할 때 사용하는 매니저
* django가 comment_set manager를 자동으로 생성해 article.comment_set 형태로 댓글 객체를 참조할 수 있음

1. 1번 글 조회하기
	article = Article.objects.get(pk=1)
2. 1번 게시글에 작성된 모든 댓글 조회하기 (역참조) 
	article.comment_set.all() 
 => <QuerySet [<Comment: first comment>, <Comment: second comment>]>

  
```

