## 비동기-AJAX

---

* 기술이름
* 자스가 어떻게 동작하는지 봐야함
* 요청을 보내고 응답을 기다리지 않고 다음 동작이 이루어짐
  * 일을 하고 있을 때, 질문 보낼 때, 답변 늦어질 때 기다리기만 하면 동기
  * 질문을 던지고 기다리는게 아니라 다른 일을 하는게 비동기
  * 라이브스트리밍도 동기임
  * 영상강의면 비동기(내가 원하고 싶은 시점에 듣고 질문던져놓고 다른 거 하고 ~)
  * 요청을 보내고 기다리지 않고 다음 코드가 실행됨
  * 자스에서는 기다리지 않고바로 실행
  * 스택: 바구니, 늦게 들어온 것이 먼저 나간다
  * 큐: 순서대로 들어오고 순서대로 나간다
  * 자스는 타임아웃이 있어도, 밑에꺼 먼저 함, 나중 완료 되면 콜백 큐에 대기하고 콜 스택으로 올라감
  * 파이썬은 요청이 도착할때까지 기다렸다가 응답에 저장하고, 그다음줄 실행
  * 자스는 요 청이 도착하는 것 안 기다림(웸 api던져놓음) -> 그리고 그냥 다음 줄 실행해버림 => 그리고 도착하면 무엇인가를 함
  * 비동기적: 타임아웃, 에이제이
  * 태스크 큐
  * 콜 스택
  * 새로고침 하지 않아도 서버로 요청을 보내고, 데이터를 받아 화면의 일부분만 업데이트 가능
  * 요즘엔 **axios 라이브러리 사용**

### 정리

* 서버로 요청을 보내면 응답을 해줌

* 완전한 html파일을 응답함(매 요청때마다)

* 비동기로 구현하면

  * 사용자는 html화면에서 버튼 눌렀더니 비동기 요청이 가고, 서버에서 응답한 결과 자체가 html이 아니라! 제이슨을 주고 제이슨 돔조작으로 바꿔줌
  * 사용자는 같은 화면을 보고 있지만 화면이 변하고, 무언가 한 결과를 받아본다는 생각을 할수가 있다. 
  * 사용자 경험이 늘어남, 새로고침이 아니라 클라이언트 쪽의 조작임
  * 자스가 실제 화면을 고쳐주고, 그것에 필요한 제이슨을 전송..

  



## Axios

---

* 프로미스
  * 도착하면 실행을 시켜주겠다, 라는 약속
  * 유알엘로 요청 보내면 t hen이라는 함수를 실행 시켜줄께, 실패하면 catch에있는 함수를 실행시켜줄께 
* 자스 쓰려면 cdn가지고 오기
  * 스크립트로 코드 작성

* 버튼 클릭하면 함수 실행해줘.
* axios는 url로 요청을 보내줌
* 처리가 완료되면 실행시켜주겠다는 약속
* 성공적이면 then, 실패면 catch
* 성공에서 받은 응답 객체를 활용한 조작!! 



### 비동기처리

1) 어떤 이벤트일때 요청을 보낼지
   1) 폼을 작성하면
   2) articles/pk/comments/
2) 서버에서 어떤 응답으로 제이슨으로 보내서
   1) 댓글 정보를 보내서
3) 돔 조작을 어떻게 할지
   1)  댓글 목록에 추가해줌

![image-20221026122213367](1026_수.assets/image-20221026122213367.png)



## 복습

---

* 자스특징(비동기 특징)
  * 요청을 보내고 **응답을 기다리지 않고** 다음 코드가 실행됨
  * 결과적으로는 변수 투두에는 응답 데이터가 할당되지 않고 빈 문자열이 출력
  * 그렇다면 js는 왜 기다려주지 않는 방식으로 작동하는가?? 
  * 셋타임아웃에는 몇 초후에 실행하는 건데, 거기에 0초여도 마지막에 출력됨(코드 순서대로가 아님)
  * 요청, 셋타임아웃, 요청이 도착할때까지 기다리지 않음(파이썬에서는 기다림)
    * 도착하는거 안 기다리려주고 웹 에이피아이에 던져놓음
    * 그리고 그냥 다음줄 실행해버림
    * 그리고 도착하면 무엇인가를 함!

### 이벤트루프 기반 동시성 모델

* Call stack(바구니)
  * 요청이 들어올 때마다 해당 요청을 순차적으로 처리하는 스택 형태의 자료구조
* Web api
  * 자스 엔진이 아닌 브라우저 영역에서 제공하는 api
  * Settimeout(), dom events, ajax
* Task queue(파이프)
  * 비동기 처리 된 콜백 함수가 대기하는 큐 형태의 자료 구조
  * 메인 쓰레드가 끝난 후 실행되어 후속 자스코드가 차단되는 것을 방지
* 이벤트 루프
  * 콜 스택이 비어져 있는지 확인
  * 비어 있는 경우, 큐에서 실행 대기중인 콜백 함수가 있는지 확인
  * 큐에 대기중인 콜백 함수가 있다면 가장 앞에 있는 콜백 함수를 콜 스택으로 푸쉬 

### AJAX란?

* 비동기식 자스와 xml => 요즘은 xml대신 json을 주로 씀
* 비동기 통신을 이용하면 화면 전체를 새로고침하지 않아도 **서버로 요청을 보내고, 데이터를 받아 화면의 일부분만 업데이트 가능**
* 이러한 **비동기 통신 웹 개발 기술**을 ajax라고 함 
* 비동기 웹 통신을 위한 라이브러리 중 하나가 axios(요즘)

### AJAX 특징

* 페이지 전체를 새로고침하지 않고서도 수행되는 비동기성
* 서버의 응답에 따라 전체 페이지가 아닌 일부분만을 업데이트 할 수 있음
  1. 페이지 새로고침 없이 서버에 요청
  2. 서버로부터 응답을 받아 작업을 수행



### 비동기 처리 

1) 어떤 이벤트일 때 요청을 보낼지
   1) 폼을 작성하면
   2) /아티클스/<pk>/comments/
2) 서버에서 어떤 응답을 제이슨으로 보내서
   1) 댓글 정보를 보내서
3) 돔 조작을 어떻게 할지
   1) 댓글 목록에 추가해줌

